<!DOCTYPE html>
<html>
<head>
    <title>GPU stats</title>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body {
            font-family: 'Ubuntu', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        #app {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-family: 'Ubuntu', sans-serif;
            color: #333;
            text-align: center;
        }

        h2 {
            color: #666;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            text-align: left;
            padding: 8px;
        }

        th {
            background-color: #f2f2f2;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .green {
            color: green;
        }

        .orange {
            color: orange;
        }

        .red {
            color: red;
        }

        .header {
            display: flex;
            align-items: center;
            gap: 10px; /* Adjust spacing between icon and title */
        }
    </style>
</head>
<body>
<div id="app">
    <div class="header">
        <!-- Begin SVG code for the GPU icon -->
        <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
             width="64.000000pt" height="64.000000pt" viewBox="0 0 64.000000 64.000000"
             preserveAspectRatio="xMidYMid meet">

            <g transform="translate(0.000000,64.000000) scale(0.100000,-0.100000)"
               fill="#000000" stroke="none">
                <path d="M60 460 c0 -13 -7 -20 -20 -20 -11 0 -20 -4 -20 -10 0 -5 9 -10 20 -10 19 0 20 -7 20 -140 0 -87 4 -140 10 -140 6 0 10 9 10 20 0 18 7 20 79 20 54 0 81 -4 85 -12 5 -10 7 -10 12 0 3 6 18 12 34 12 16 0 31 -6 34 -12 5 -10 7 -10 12 0 4 9 41 12 135 12 l129 0 0 150 0 150 -270 0 c-263 0 -270 0 -270 -20z m520 -130 l0 -130 -250 0 -250 0 0 130 0 130 250 0 250 0 0 -130z" fill="#000000"/>
                <path d="M161 416 c-87 -48 -50 -186 49 -186 51 0 100 49 100 99 0 75 -83 124 -149 87z m97 -22 c27 -19 28 -34 2 -34 -28 0 -25 -17 5 -24 29 -7 31 -22 9 -54 -19 -27 -34 -28 -34 -2 0 28 -17 25 -24 -5 -7 -29 -22 -31 -54 -9 -27 19 -28 34 -2 34 28 0 25 17 -5 24 -29 7 -31 22 -9 54 19 27 34 28 34 2 0 -28 17 -25 24 5 7 29 22 31 54 9z" fill="#000000"/>
                <path d="M200 330 c0 -5 5 -10 10 -10 6 0 10 5 10 10 0 6 -4 10 -10 10 -5 0 -10 -4 -10 -10z" fill="#FF0000"/>
                <path d="M401 416 c-87 -48 -50 -186 49 -186 51 0 100 49 100 99 0 75 -83 124 -149 87z m97 -22 c27 -19 28 -34 2 -34 -28 0 -25 -17 5 -24 29 -7 31 -22 9 -54 -19 -27 -34 -28 -34 -2 0 28 -17 25 -24 -5 -7 -29 -22 -31 -54 -9 -27 19 -28 34 -2 34 28 0 25 17 -5 24 -29 7 -31 22 -9 54 19 27 34 28 34 2 0 -28 17 -25 24 5 7 29 22 31 54 9z" fill="#000000"/>
                <path d="M440 330 c0 -5 5 -10 10 -10 6 0 10 5 10 10 0 6 -4 10 -10 10 -5 0 -10 -4 -10 -10z" fill="#FF0000"/>
            </g>
        </svg>
        <!-- End SVG code -->
        <h1>GPU stats</h1>
    </div>
    <div>
        <label for="refresh-interval">Refresh Interval:</label>
        <select id="refresh-interval" v-model="refreshInterval">
            <option value="2000">2 sec</option>
            <option value="5000">5 sec</option>
            <option value="10000">10 sec</option>
            <option value="30000">30 sec</option>
            <option value="60000">60 sec</option>
        </select>
    </div>
    <div v-for="(serverData, serverIP) in servers" :key="serverIP">
        <h2>{{ serverData.hostname ? `${serverData.hostname} (${serverIP})` : serverIP }}</h2>
        <table v-if="serverData.GPUs">
            <tr>
                <th>ID</th>
                <th>
                    <svg fill="#000000" height="16px" width="16px" version="1.1" id="Layer_1"
                         xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                         viewBox="0 0 512 512" xml:space="preserve">
                    <g>
                        <g>
                            <polygon
                                    points="169.547,169.547 169.547,342.455 208.309,342.455 208.309,327.247 184.755,327.247 184.755,184.755 327.247,184.755 327.247,327.247 228.589,327.247 228.589,342.455 342.455,342.455 342.455,169.547"/>
                        </g>
                    </g>
                        <g>
                        <g>
                            <path d="M512,283.675v-55.354h-92.878v-30.256H512v-55.354h-92.878V92.879h-49.837V0h-55.354v92.879h-30.256V0h-55.354v92.879
                                h-30.256V0h-55.354v92.879H92.879v49.836H0v55.354h92.879v30.256H0v55.354h92.879v30.256H0v55.354h92.879v49.833h49.836V512
                                h55.354v-92.878h30.256V512h55.354v-92.878h30.256V512h55.354v-92.878h49.833v-49.838H512v-55.354h-92.878v-30.256H512z
                                 M92.879,354.08H15.208v-24.938h77.671V354.08z M92.879,268.471H15.208v-24.938h77.671V268.471z M92.879,182.861H15.208v-24.938
                                h77.671V182.861z M419.122,157.92h77.67v24.938h-77.67V157.92z M329.139,15.208h24.938v77.671h-24.938V15.208z M243.529,15.208
                                h24.938v77.671h-24.938V15.208z M157.92,15.208h24.938v77.671H157.92V15.208z M182.861,496.792h-24.938v-77.67h24.938V496.792z
                                 M268.471,496.792h-24.938v-77.67h24.938V496.792z M329.142,496.792v-77.67h24.938v77.67H329.142z M403.914,142.711h-0.001v55.354
                                h0.001v30.256h-0.001v55.354h0.001v30.256h-0.001v55.354h0.001v34.63h-34.625v-0.001h-55.354v0.001h-30.256v-0.001h-55.354v0.001
                                h-30.256v-0.001h-55.354v0.001h-34.628v-34.625v-55.354v-30.256v-55.354v-30.256v-55.354v-34.628h34.624h55.354h30.256h55.354
                                h30.256h55.354h34.63V142.711z M496.792,329.139v24.938h-77.67v-24.938H496.792z M419.122,268.467v-24.938h77.67v24.938H419.122z"
                            />
                        </g>
                    </g>
                    </svg>
                    Utilization
                </th>
                <th>
                    <svg width="16px" height="16px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 15.9998C11.4477 15.9998 11 16.4475 11 16.9998C11 17.5521 11.4477 17.9998 12 17.9998C12.5523 17.9998 13 17.5521 13 16.9998C13 16.4475 12.5523 15.9998 12 15.9998ZM12 15.9998L12.0071 10.5M12 16.9998L12.0071 17.0069M16 16.9998C16 19.209 14.2091 20.9998 12 20.9998C9.79086 20.9998 8 19.209 8 16.9998C8 15.9854 8.37764 15.0591 9 14.354L9 6C9 4.34315 10.3431 3 12 3C13.6569 3 15 4.34315 15 6V14.354C15.6224 15.0591 16 15.9854 16 16.9998Z"
                              stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Temperature
                </th>
                <th>
                    <svg width="16px" height="16px" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink"
                         viewBox="0 0 512 512" xml:space="preserve">
                        <style type="text/css">
                            .st0 {
                                fill: #000000;
                            }
                        </style>
                        <g>
                            <path class="st0" d="M165.394,285.996c1.643-1.643,1.643-4.314,0-5.958l-1.086-1.086c-1.643-1.643-4.314-1.643-5.956,0
                                l-8.247,8.232l7.058,7.05L165.394,285.996z"/>
                            <path class="st0" d="M171.249,308.328l8.246-8.232c1.644-1.651,1.644-4.314,0-5.957l-1.1-1.101c-1.643-1.643-4.314-1.643-5.957,0
                                l-8.232,8.247L171.249,308.328z"/>
                            <path class="st0" d="M193.581,308.225l-1.086-1.086c-1.643-1.644-4.314-1.644-5.957,0l-8.246,8.232l7.058,7.05l8.232-8.238
                                C195.224,312.539,195.224,309.868,193.581,308.225z"/>
                            <path class="st0" d="M207.667,328.276c1.658-1.643,1.658-4.306,0.015-5.95l-1.1-1.1c-1.643-1.644-4.314-1.644-5.958,0l-8.232,8.246
                                l7.043,7.043L207.667,328.276z"/>
                            <path class="st0" d="M96.035,341.255l-8.231,8.239c-1.644,1.643-1.644,4.306,0,5.949l1.1,1.101c1.644,1.644,4.3,1.644,5.958,0
                                l8.232-8.232L96.035,341.255z"/>
                            <path class="st0" d="M110.135,355.355l-8.232,8.231c-1.643,1.644-1.643,4.315,0,5.958l1.086,1.086c1.644,1.644,4.314,1.644,5.958,0
                                l8.232-8.232L110.135,355.355z"/>
                            <path class="st0" d="M124.221,369.441l-8.231,8.239c-1.643,1.644-1.643,4.307,0,5.95l1.085,1.101c1.658,1.643,4.315,1.643,5.958,0
                                l8.247-8.239L124.221,369.441z"/>
                            <path class="st0" d="M138.322,383.535l-8.232,8.239c-1.644,1.643-1.644,4.314-0.015,5.95l1.1,1.093
                                c1.643,1.643,4.314,1.643,5.958,0l8.232-8.232L138.322,383.535z"/>
                            <path class="st0" d="M220.667,335.319c-1.629-1.635-4.3-1.635-5.942,0.008l-8.247,8.232l7.043,7.043l8.247-8.232
                                c1.643-1.643,1.643-4.306,0-5.958L220.667,335.319z"/>

                            <rect x="94.992" y="313.927"
                                  transform="matrix(-0.7071 -0.7071 0.7071 -0.7071 19.6226 699.9984)" class="st0"
                                  width="119.587" height="64.016"/>
                            <path class="st0" d="M144.177,405.867c-1.644,1.643-1.644,4.306,0,5.95l1.086,1.093c1.658,1.65,4.314,1.643,5.957,0l8.232-8.239
                                l-7.043-7.043L144.177,405.867z"/>
                            <path class="st0" d="M260.974,190.43c1.644-1.65,1.644-4.314,0-5.957l-1.1-1.1c-1.644-1.644-4.314-1.644-5.958,0l-8.232,8.246
                                l7.043,7.043L260.974,190.43z"/>
                            <path class="st0" d="M266.828,212.755l8.232-8.239c1.644-1.643,1.644-4.314,0-5.957l-1.086-1.086c-1.643-1.643-4.314-1.643-5.958,0
                                l-8.246,8.232L266.828,212.755z"/>
                            <path class="st0" d="M289.161,212.653l-1.1-1.093c-1.643-1.643-4.314-1.643-5.958,0l-8.232,8.246l7.043,7.043l8.246-8.239
                                C290.804,216.966,290.804,214.303,289.161,212.653z"/>
                            <path class="st0" d="M303.247,232.704c1.643-1.644,1.643-4.315,0-5.958l-1.101-1.093c-1.643-1.636-4.3-1.636-5.942,0.008
                                l-8.246,8.232l7.058,7.043L303.247,232.704z"/>
                            <path class="st0" d="M184.468,260.964c1.644,1.643,4.315,1.643,5.958,0l8.232-8.232l-7.043-7.043l-8.232,8.232
                                c-1.643,1.643-1.658,4.314,0,5.957L184.468,260.964z"/>
                            <path class="st0" d="M197.469,268.014c-1.643,1.643-1.643,4.306,0,5.949l1.1,1.101c1.643,1.644,4.3,1.644,5.942,0l8.247-8.239
                                l-7.058-7.05L197.469,268.014z"/>
                            <path class="st0" d="M211.57,288.065l1.086,1.086c1.643,1.644,4.314,1.644,5.958,0l8.232-8.232l-7.043-7.043l-8.232,8.232
                                C209.926,283.751,209.926,286.421,211.57,288.065z"/>
                            <path class="st0" d="M233.888,287.962l-8.232,8.232c-1.644,1.651-1.644,4.314,0,5.957l1.1,1.101c1.644,1.643,4.3,1.643,5.943-0.008
                                l8.246-8.232L233.888,287.962z"/>
                            <path class="st0" d="M316.248,239.747c-1.644-1.644-4.314-1.644-5.958,0l-8.232,8.246l7.043,7.043l8.232-8.239
                                c1.643-1.651,1.658-4.306,0-5.957L316.248,239.747z"/>
                            <polygon class="st0"
                                     points="185.452,230.715 269.998,315.269 315.264,270.002 230.703,185.449 	"/>
                            <path class="st0" d="M239.757,310.294c-1.643,1.643-1.643,4.314-0.014,5.95l1.1,1.093c1.644,1.65,4.314,1.643,5.957,0l8.232-8.232
                                l-7.043-7.05L239.757,310.294z"/>
                            <path class="st0" d="M356.539,94.85c1.644-1.643,1.644-4.314,0-5.957l-1.086-1.086c-1.643-1.643-4.314-1.643-5.958,0l-8.246,8.232
                                l7.058,7.05L356.539,94.85z"/>
                            <path class="st0" d="M362.394,117.183l8.246-8.239c1.643-1.643,1.643-4.306,0-5.95l-1.1-1.1c-1.643-1.643-4.314-1.643-5.958,0
                                l-8.232,8.246L362.394,117.183z"/>
                            <path class="st0" d="M376.495,131.276l8.232-8.239c1.643-1.643,1.643-4.314,0-5.957l-1.086-1.086c-1.644-1.643-4.314-1.643-5.958,0
                                l-8.246,8.232L376.495,131.276z"/>
                            <path class="st0" d="M390.581,145.37l8.232-8.239c1.643-1.644,1.658-4.307,0.014-5.95l-1.1-1.1c-1.644-1.643-4.314-1.643-5.958,0
                                l-8.232,8.239L390.581,145.37z"/>
                            <path class="st0" d="M280.049,165.398c1.643,1.643,4.3,1.643,5.958,0l8.232-8.239l-7.058-7.051l-8.232,8.232
                                c-1.643,1.65-1.643,4.314,0,5.958L280.049,165.398z"/>
                            <path class="st0" d="M301.281,164.21l-8.232,8.232c-1.644,1.643-1.644,4.314,0,5.957l1.086,1.086c1.643,1.643,4.314,1.643,5.957,0
                                l8.232-8.232L301.281,164.21z"/>
                            <path class="st0" d="M315.367,178.296l-8.232,8.238c-1.644,1.644-1.644,4.307,0,5.95l1.1,1.093c1.643,1.651,4.299,1.651,5.942,0
                                l8.246-8.232L315.367,178.296z"/>
                            <path class="st0" d="M329.468,192.389l-8.232,8.239c-1.658,1.644-1.658,4.314-0.014,5.95l1.101,1.093
                                c1.643,1.644,4.314,1.644,5.956,0l8.232-8.232L329.468,192.389z"/>
                            <path class="st0" d="M411.813,144.174c-1.629-1.636-4.299-1.636-5.943,0.008l-8.246,8.232l7.057,7.043l8.232-8.232
                                c1.644-1.644,1.644-4.314,0-5.957L411.813,144.174z"/>

                            <rect x="286.137" y="122.781"
                                  transform="matrix(-0.7071 -0.7071 0.7071 -0.7071 481.0893 508.8518)" class="st0"
                                  width="119.587" height="64.016"/>
                            <path class="st0" d="M335.322,214.721c-1.643,1.644-1.643,4.306,0,5.95l1.086,1.093c1.658,1.65,4.314,1.644,5.957,0l8.232-8.239
                                l-7.043-7.043L335.322,214.721z"/>
                            <path class="st0" d="M472.31,117.322c-8.1,8.1-21.232,8.092-29.332,0c-8.099-8.1-8.099-21.224,0-29.331l-27.307-27.307
                                c-8.099,8.099-21.231,8.092-29.331,0c-8.099-8.099-8.099-21.224,0-29.332L354.984,0.003L0,354.981l31.356,31.349
                                c8.099-8.092,21.232-8.092,29.332,0c8.099,8.107,8.099,21.239,0,29.332l27.306,27.306c8.1-8.092,21.232-8.092,29.331,0
                                c8.1,8.107,8.1,21.24,0,29.331l39.69,39.698L512,157.013L472.31,117.322z M469.595,184.239l-13.675,13.682l-14.894-14.9
                                l-8.965,8.965l14.893,14.894l-13.675,13.682l-14.893-14.9l-8.966,8.966l14.893,14.893l-13.675,13.675l-14.893-14.893l-8.965,8.958
                                l14.894,14.9l-13.676,13.675l-14.893-14.893l-8.965,8.958l14.893,14.9l-13.675,13.675l-14.894-14.893l-8.965,8.957l14.893,14.9
                                l-13.675,13.676l-14.893-14.894l-8.966,8.95l14.893,14.908l-13.675,13.675l-14.893-14.893l-8.965,8.958l14.894,14.9l-13.675,13.675
                                l-14.894-14.893l-8.965,8.958l14.893,14.9l-13.675,13.675l-14.893-14.9l-8.966,8.958l14.908,14.907l-13.69,13.675l-14.893-14.893
                                l-8.966,8.95l14.908,14.908l-13.69,13.675l-14.893-14.893l-8.965,8.958l14.893,14.901l-13.675,13.675l-14.894-14.901l-8.965,8.958
                                l14.908,14.901l-13.69,13.682l-14.893-14.9l-8.966,8.957l14.908,14.9l-18.268,18.268l-25.854-25.846
                                c5.429-11.658,3.346-25.986-6.25-35.59c-9.611-9.603-23.932-11.686-35.582-6.258l-14.805-14.79
                                c5.429-11.658,3.346-25.986-6.251-35.589c-9.611-9.604-23.931-11.688-35.582-6.258l-17.52-17.513L354.984,15.176l17.519,17.505
                                c-5.444,11.65-3.36,25.985,6.251,35.582c9.596,9.611,23.932,11.694,35.582,6.258l14.805,14.797
                                c-5.444,11.666-3.36,25.986,6.25,35.582c9.596,9.611,23.932,11.695,35.582,6.259l25.854,25.854l-18.268,18.268l-14.893-14.901
                                l-8.966,8.966L469.595,184.239z"/>
                        </g>
                        </svg>
                    Memory Usage
                </th>
                <th>
                    <svg fill="#000000" width="16px" height="16px" viewBox="0 0 24 24"
                         xmlns="http://www.w3.org/2000/svg">
                        <path d="M7.493,22.862a1,1,0,0,0,1.244-.186l11-12A1,1,0,0,0,19,9H13.133l.859-6.876a1,1,0,0,0-1.8-.712l-8,11A1,1,0,0,0,5,14H9.612l-2.56,7.684A1,1,0,0,0,7.493,22.862ZM6.964,12l4.562-6.273-.518,4.149A1,1,0,0,0,12,11h4.727l-6.295,6.867,1.516-4.551A1,1,0,0,0,11,12Z"/>
                    </svg>
                    Power
                </th>
            </tr>
            <tr v-for="gpu in serverData.GPUs" :key="gpu.gpu_id">
                <td>{{ gpu.gpu_id }}</td>
                <td :class="utilizationClass(gpu.gpu_util)">{{ gpu.gpu_util }}</td>
                <td :class="temperatureClass(gpu.temperature)">{{ gpu.temperature }}</td>
                <td>{{ gpu.memory_usage }} ({{ calculateMemoryUsage(gpu.memory_usage) }}%)</td>
                <td>{{ gpu.power }}</td>
            </tr>
        </table>
    </div>
</div>

<script>
    new Vue({
        el: '#app',
        data() {
            return {
                serverList: ['1.1.1.1', '2.2.2.2', '3.3.3.3'], // Add your server IPs here
                servers: {},
                refreshInterval: 5000, // Default refresh interval
                intervalId: null
            };
        },
        methods: {
            async fetchGPUData(serverIP) {
                try {
                    const response = await axios.get(`http://${serverIP}:8080/gpustats`);
                    this.$set(this.servers, serverIP, response.data);
                } catch (error) {
                    console.error('Error fetching data from', serverIP, error);
                    this.$set(this.servers, serverIP, {error: 'Unable to fetch data'});
                }
            },
            startFetchingData() {
                this.stopFetchingData();
                this.serverList.forEach(serverIP => {
                    this.fetchGPUData(serverIP);
                });
                this.intervalId = setInterval(() => {
                    this.serverList.forEach(serverIP => {
                        this.fetchGPUData(serverIP);
                    });
                }, this.refreshInterval);
            },
            stopFetchingData() {
                if (this.intervalId) {
                    clearInterval(this.intervalId);
                }
            },
            temperatureClass(temp) {
                const temperature = parseInt(temp);
                if (temperature < 40) return 'green';
                if (temperature >= 40 && temperature < 60) return 'orange';
                return 'red';
            },
            utilizationClass(util) {
                const utilization = parseInt(util);
                if (utilization < 40) return 'green';
                if (utilization >= 40 && utilization < 60) return 'orange';
                return 'red';
            },
            calculateMemoryUsage(memoryUsage) {
                const [used, total] = memoryUsage.split(' / ').map(mem => parseFloat(mem));
                return ((used / total) * 100).toFixed(2); // toFixed(2) limits the result to 2 decimal places
            }
        },
        watch: {
            refreshInterval: function (newInterval, oldInterval) {
                this.startFetchingData();
            }
        },
        mounted() {
            this.startFetchingData();
        },
        beforeDestroy() {
            this.stopFetchingData();
        }
    });
</script>
</body>
</html>
